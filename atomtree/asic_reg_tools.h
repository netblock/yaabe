/*
A major purpose of  struct register_set  is to have a searchable
register index-bitfield database.

register_set_print_tables crawls through the index list in the bios to print
various text sequences to make it easier to write tables seen in
atom/asic_reg_data_tables.h and atomtree/asic_reg_indices.json5

Another purpose is register_set_build_atuifunc_playlist which is to have
runtime ATUI branch generation based on the register index list in the bios

see also:
struct atomtree_init_reg_block
atom/asic_reg_data_tables.h
atomtree/asic_reg_indices.json5

atomtree/gmc_searchfield.json5
scripts/asic_reg/asic_reg.py
searchfield_to_c in scripts/ppatui.py
*/

#ifndef ASIC_REG_TOOLS_H
#define ASIC_REG_TOOLS_H

// see bottom for more includes

/*
A register of a general name may have multiple different versions. These
versions may differ in the numeric address or its bitfield, or both. They also
may not differ at all.
*/
struct register_set_entry { // register set entry
	uint16_t address; // mm,ix,reg prefixed defines
	char const* index_name;
	char const* field_name;
	atuifunc atui_branch_func;
};
struct register_set {
	char const* set_name;
	uint16_t num_reg_set_addresses;
	struct register_set_entry entries[] __counted_by(num_reg_set_addresses);
};

typedef int16_t (* regset_bsearch_func)(struct register_set const* reg_set, uint16_t address);
int16_t
regset_bsearch_left(
		struct register_set const* reg_set,
		uint16_t address
		);
int16_t
regset_bsearch_right(
		struct register_set const* reg_set,
		uint16_t address
		);


// build a list of atui branch function pointers based off of the regblock.
// must be freed; length is atomtree_init_reg_block.num_data_entries
struct register_set_entry*
register_set_build_atuifunc_playlist(
		struct atomtree_init_reg_block const* const at_regblock,
		struct register_set const* const reg_set,
		bool newest // suggest oldest or newest if there's multiple versions
		);
void
register_set_print_tables( // entirely a developer's tool
		struct atomtree_init_reg_block const* at_regblock,
		struct register_set const* reg_set,
		bool newest, // suggest oldest or newest if there's multiple versions
		char const* name
		);


// compare register index sequences. expectation asserts END_OF_REG_INDEX_BLOCK
uint8_t
regcmp(
		struct atom_init_reg_index_format const* index,
		uint16_t const* expectation
		);


// ppatui.py autogenerated:
#include "gmc_searchfield.h"

#endif
